<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Settings | ESCR</title>
        <link rel="stylesheet" href="css/navbar.css">
        <link rel="stylesheet" href="css/settings.css">
    </head>
    <body>

        <!-- TOP NAVBAR -->
        <header class="topbar modern">
            <div class="topbar-left">
                <button class="menu-btn" onclick="toggleSidebar()">‚ò∞</button>
                <img src="images/school-logo.jpg" class="logo">
                <div class="title">
                    <strong class="school-text">East Systems Colleges of Rizal</strong>
                    <br>
                    <span class="portal-text">Student Portal</span>
                </div>
            </div>

            <div class="topbar-right">
                <div class="profile">
                    <div class="avatar"></div>
                    <div class="profile-text">
                        <strong class="student-name"></strong>
                        <span class="student-role"></span>
                    </div>
                </div>
            </div>
        </header>

        <!-- SIDEBAR -->
        <aside class="sidebar modern" id="sidebar">
            <a href="dashboard.html">üè† Dashboard</a>
            <a href="chatbot.html">ü§ñ ESCR Chatbot</a>
            <a href="class-schedule.html">üìÖ Class Schedule</a>
            <a href="school-calendar.html">üóì School Calendar</a>
            <a href="settings.html" class="active">‚öôÔ∏è Settings</a>
            <a href="login.html" class="logout">üö™ Logout</a>
        </aside>

        <!-- CONTENT -->
        <div class="content-single">
            <div class="settings-card">

                <!-- TABS -->
                <div class="tabs">
                    <button onclick="showTab('profile', this)" class="active">Profile</button>
                    <button onclick="showTab('account', this)">Account</button>
                </div>

                <!-- PROFILE TAB -->
                <div id="profile" class="tab-content active profile-card-ui">

                    <div class="profile-header">
                        <div class="avatar large" id="profileAvatar"></div>

                        <div class="profile-photo-actions">
                            <strong>Profile Picture</strong>
                            <small>Upload your profile photo</small>

                            <div class="photo-buttons">
                                <button class="btn primary" onclick="triggerPhotoUpload()">Upload Photo</button>
                                <button class="btn secondary" onclick="removePhoto()">Remove</button>
                            </div>

                            <input
                                type="file"
                                id="profilePhotoInput"
                                accept="image/*"
                                style="display:none"
                            >
                        </div>
                    </div>

                    <div class="profile-form-grid">
                        <div>
                            <label>First Name</label>
                            <input id="set_first_name">
                        </div>

                        <div>
                            <label>Last Name</label>
                            <input id="set_last_name">
                        </div>

                        <div>
                            <label>Email</label>
                            <input id="set_email">
                        </div>

                        <div>
                            <label>Phone Number</label>
                            <input id="set_phone">
                        </div>

                        <div class="full-width">
                            <label>Address</label>
                            <input id="set_address">
                        </div>

                        <div>
                            <label>Birthdate</label>
                            <input id="set_birthdate" type="date">
                        </div>
                    </div>

                    <div class="profile-actions">
                        <button class="btn secondary">Cancel</button>
                        <button class="btn primary" onclick="updateProfile()">Save Changes</button>
                    </div>
                </div>

                <!-- ACCOUNT TAB -->
                <div id="account" class="tab-content">
                    <div class="account-info-box">
                        <strong>Account Information</strong>
                        <p><b>Program:</b> Bachelor of Science in Information Technology</p>
                        <p><b>Year Level:</b> 4th Year</p>
                        <p class="status-active"><b>Account Status:</b> Active</p>
                    </div>

                    <div class="account-form">
                        <div>
                            <label>Current Password</label>
                            <input id="current_password" type="password">
                        </div>

                        <div>
                            <label>New Password</label>
                            <input id="new_password" type="password">
                        </div>

                        <div>
                            <label>Confirm New Password</label>
                            <input id="confirm_password" type="password">
                        </div>
                    </div>

                    <div class="profile-actions">
                        <button class="btn secondary">Cancel</button>
                        <button class="btn primary" onclick="changePassword()">Save Changes</button>
                    </div>
                </div>

            </div>
        </div>

    <script src="script.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            requireLogin();
            loadUserInfo();
            loadAvatarEverywhere();
        });

        function toggleSidebar() {
            document.getElementById("sidebar").classList.toggle("show");
        }

        function triggerPhotoUpload() {
            document.getElementById("profilePhotoInput").click();
        }

       document.getElementById("profilePhotoInput").addEventListener("change", function () {
    const file = this.files[0];
    if (!file) return;

    const reader = new FileReader();

    reader.onload = () => {
        const imageData = reader.result;

        const avatar = document.getElementById("profileAvatar");
        avatar.textContent = "";
        avatar.style.backgroundImage = `url(${imageData})`;
        avatar.style.backgroundSize = "cover";
        avatar.style.backgroundPosition = "center";

        // ‚úÖ SAVE HERE (after image is loaded)
        localStorage.setItem("profile_photo", imageData);
    };

    reader.readAsDataURL(file);
});

    </script>

    </body>
</html>
