<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>School Calendar</title>
        <link rel="stylesheet" href="css/navbar.css">
        <link rel="stylesheet" href="css/calendar.css">
        <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>
    </head>
    <div id="notifPanel" class="notif-panel">
        <h3>Notifications</h3>
        <div id="notifList"></div>
    </div>
    <body>

        <!-- TOP NAVBAR -->
        <header class="topbar modern">
            <div class="topbar-left">
                <button class="menu-btn" onclick="toggleSidebar()">‚ò∞</button>
                <img src="images/school-logo-remove-background.png" class="logo">
                <div class="title">
                    <strong class="school-text">East Systems Colleges of Rizal</strong>
                    <br>
                    <span class="portal-text">Student Portal</span>
                </div>
            </div>

            <div class="topbar-right">
                <div class="notif-bell" onclick="openNotifications()">
                    üîî <span id="notifCount" class="notif-count">0</span>
                </div>
                <div class="profile">
                    <div class="avatar"></div>
                    <div class="profile-text">
                        <strong class="student-name"></strong>
                        <span class="student-role"></span>
                    </div>
                </div>
            </div>
        </header>

        <!-- SIDEBAR -->
        <aside class="sidebar modern" id="sidebar">
            <a href="dashboard.html">üè† Dashboard</a>
            <a href="chatbot.html">ü§ñ ESCR Chatbot</a>
            <a href="class-schedule.html">üìÖ Class Schedule</a>
            <a href="school-calendar.html" class="active">üóì School Calendar</a>
            <a href="settings.html">‚öôÔ∏è Settings</a>
            <a href="login.html" class="logout">üö™ Logout</a>
        </aside>

        <!-- MAIN CONTENT -->
        <div class="content-single">
            <div class="calendar-red">
                <div class="calendar-white">
                    <div id="calendar"></div>
                    <!-- EVENT MODAL -->
                    <div id="eventModal" class="event-modal">
                    <div class="event-modal-box">

                        <div class="event-modal-header">
                        <h2 id="modalTitle"></h2>
                        <button class="close-btn" onclick="closeEventModal()">√ó</button>
                        </div>

                        <div class="event-modal-body">
                        <p id="modalDate"></p>
                        <p id="modalDescription"></p>
                        </div>

                    </div>
                    </div>
                </div>
            </div>
        </div>
<!-- GLOBAL TOAST -->
<div id="toast-container"></div>
<script src="toast.js"></script>
    <script src="script.js"></script>

    <script>
        function toggleSidebar() {
            document.getElementById("sidebar").classList.toggle("show");
        }
    </script>

    <script>
document.addEventListener("DOMContentLoaded", async () => {

    requireLogin();
    loadUserInfo();
    loadAvatarEverywhere();

        const res = await fetch("http://localhost:5000/calendar");
    const data = await res.json();

    // IMPORTANT: map description into extendedProps
    const events = data.map(e => ({
        id: e.id,
        title: e.title,
        start: e.start,
        end: e.end,
        color: e.color,
        extendedProps: {
            description: e.description
        }
    }));

    const calendarEl = document.getElementById("calendar");

const calendar = new FullCalendar.Calendar(calendarEl, {
    initialView: 'dayGridMonth',
    height: 650,
    events: events,

    displayEventTime: false,

    eventClick: function(info){

        const title = info.event.title;
        const desc = info.event.extendedProps.description || "No description";
        const start = info.event.start.toLocaleDateString("en-US", {
            year: "numeric",
            month: "long",
            day: "numeric"
        });

        let end = "";
        if(info.event.end){
            end = " - " + info.event.end.toLocaleDateString("en-US", {
                year: "numeric",
                month: "long",
                day: "numeric"
            });
        }

        document.getElementById("modalTitle").textContent = title;
        document.getElementById("modalDate").textContent = start + end;
        document.getElementById("modalDescription").textContent = desc;

        document.getElementById("eventModal").classList.add("show");
    }
});
    calendar.render();
});
</script>
<script>
function closeEventModal(){
    document.getElementById("eventModal").classList.remove("show");
}
</script>


    </body>
</html>
